<div class="ratings-container">
  <h1>CALIFICA NUESTROS ESCENARIOS</h1>

  <div class="pixel-panel form-panel">
    
    <form [formGroup]="ratingForm" (ngSubmit)="onSubmit()">

      <div class="form-group">
        <label for="scenario">Escenario y Dificultad</label>
        <select id="scenario" formControlName="scenario" (change)="onScenarioChange($event)">
          <option [ngValue]="null" disabled>Selecciona uno...</option>
          <option *ngFor="let s of scenariosList" [ngValue]="s">
            {{ s.nombre }}
          </option>
        </select>
      </div>

      <div *ngIf="selectedScenario" class="pixel-panel scenario-preview-card">
        <img [src]="'assets/galeria/' + selectedScenario.imagen" [alt]="selectedScenario.nombre" class="preview-image">
        <p class="scenario-name">{{ selectedScenario.nombre }}</p>
      </div>

      <div class="form-group rating-stars-group">
        <label>Valoración</label>
        <div class="stars-wrapper">
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <span 
              class="star" 
              [style.color]="getStarColor(star)"
              (click)="setRating(star)" 
              (mouseenter)="starEnter(star)" 
              (mouseleave)="starLeave()"
            >
              ★
            </span>
          </ng-container>
        </div>
        <div *ngIf="ratingForm.get('rating')?.invalid && ratingForm.get('rating')?.touched" class="error-message">
          Por favor, selecciona una calificación.
        </div>
      </div>

      <div class="form-group">
        <label for="comment">Comentarios</label>
        <textarea id="comment" formControlName="comment" rows="4" placeholder="¿Qué te pareció este escenario?"></textarea>
        
        <div *ngIf="ratingForm.get('comment')?.hasError('required') && ratingForm.get('comment')?.touched" class="error-message">
          El comentario es obligatorio.
        </div>
        <div *ngIf="ratingForm.get('comment')?.hasError('minlength')" class="error-message">
          El comentario debe tener al menos 10 caracteres.
        </div>
      </div>

      <div class="submit-group">
        <button type="submit" class="pixel-button submit-button" [disabled]="ratingForm.invalid">
          ENVIAR CALIFICACIÓN
        </button>
      </div>

    </form>
  </div>
</div>